name: ğŸ“š Initial Full Collection (Manual)

# Ce workflow est pour la PREMIÃˆRE collection complÃ¨te
# Lance-le MANUELLEMENT depuis GitHub
# Pour les mises Ã  jour quotidiennes, utilise auto-update.yml

on:
  workflow_dispatch:  # Lancement manuel uniquement
    inputs:
      start_year:
        description: 'AnnÃ©e de dÃ©but'
        required: true
        default: '2020'
      end_year:
        description: 'AnnÃ©e de fin'
        required: true
        default: '2025'

jobs:
  full-collection:
    runs-on: ubuntu-latest
    timeout-minutes: 4320  # Max 3 jours
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ Install dependencies
      run: |
        pip install --upgrade pip
        pip install requests
    
    - name: ğŸš€ Full Collection
      run: |
        echo "ğŸš€ Collection de ${{ github.event.inputs.start_year }} Ã  ${{ github.event.inputs.end_year }}"
        echo "âš ï¸  Ceci peut prendre PLUSIEURS HEURES/JOURS!"
        
        python3 arxiv_full_collector.py collect ${{ github.event.inputs.start_year }} ${{ github.event.inputs.end_year }}
    
    - name: ğŸ“¤ Export to JSON
      run: |
        python3 arxiv_full_collector.py export articles.json
    
    - name: ğŸ“Š Show statistics
      run: |
        python3 arxiv_full_collector.py stats
    
    - name: ğŸ“¦ Check file sizes
      run: |
        echo "ğŸ“Š Tailles des fichiers:"
        du -h articles.json
        du -h arxiv_full_collection.db
    
    - name: ğŸ’¾ Commit results
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        git add articles.json arxiv_full_collection.db
        git commit -m "ğŸ“š Initial collection: ${{ github.event.inputs.start_year }}-${{ github.event.inputs.end_year }}"
        git push
    
    - name: ğŸ“¦ Upload artifacts (backup)
      uses: actions/upload-artifact@v3
      with:
        name: full-collection-${{ github.event.inputs.start_year }}-${{ github.event.inputs.end_year }}
        path: |
          articles.json
          arxiv_full_collection.db
        retention-days: 90
